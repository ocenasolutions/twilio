<!DOCTYPE html>
<html>
<head>
  <title>Twilio Call App</title>
  <script src="https://sdk.twilio.com/js/client/v1.13/twilio.min.js"></script>
</head>
<body>
  <h1>Twilio Browser Calling</h1>

  <input type="text" id="number" placeholder="Enter phone number (e.g. +256...)"/>
  <button onclick="makeCall()">Call</button>
  <button onclick="hangup()">Hang Up</button>

  <script>
    let device;

    fetch('/token')
      .then(res => res.json())
      .then(data => {
        device = new Twilio.Device(data.token, {
          codecPreferences: ['opus', 'pcmu'],
          fakeLocalDTMF: true,
          enableRingingState: true
        });

        device.on('ready', () => console.log('Device is ready'));
        device.on('error', error => console.error('Twilio Error:', error));
        device.on('disconnect', call => console.log('Call disconnected'));
      });

    function makeCall() {
      const number = document.getElementById('number').value;
      if (device) {
        device.connect({ To: number });
      }
    }

    function hangup() {
      if (device) {
        device.disconnectAll();
      }
    }
  </script>
</body>
</html>
